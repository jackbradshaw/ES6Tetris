(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var _srcTetrisViewmodel = require("./src/TetrisViewmodel");

var _srcTetrisViewmodel2 = _interopRequireDefault(_srcTetrisViewmodel);

var viewModel = new TetrisViewModel(12, 20, "blue");

},{"./src/TetrisViewmodel":3}],2:[function(require,module,exports){
"use strict";

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var _Tetromino = require("./Tetromino");

var _Tetromino2 = _interopRequireDefault(_Tetromino);

var Grid = (function () {
    var self;
    var row = 0;
    self.block;

    var Grid = function Grid(width, height) {
        self = this;
        self.tiles = ko.observableArray();
        for (var y = 0; y < height; y++) {
            addRow();
        }
    };

    function addRow() {
        var row = [];
        for (var x = 0; x < width; x++) {
            row[x] = new Tile(false, self.colour);
        }
        self.tiles.unshift(row);
    }

    Grid.prototype.removeCompleteRows = function () {
        self.tiles().forEach(function (row) {
            var rowComplete = row.every(function (tile) {
                return tile.occupied();
            });
            if (rowComplete) {
                self.tiles.remove(row);
                addRow();
            }
        });
    };

    Grid.prototype.moveDown = function () {
        var moved = self.block.move({ x: 0, y: 1 });
        if (!moved) {
            self.addBlock(self.getNewBlock(), { x: 5, y: 0 });
            self.removeCompleteRows();
        }
    };

    Grid.prototype.addBlock = function (block) {
        self.block = block;
    };

    Grid.prototype.getNewBlock = function () {
        var blocks = [makeBlock([{ x: 0, y: 0 }, { x: 0, y: 1 }, { x: 1, y: 1 }, { x: 1, y: 2 }], "red"), makeBlock([{ x: 0, y: 1 }, { x: 1, y: 1 }, { x: 1, y: 0 }, { x: 2, y: 0 }], "green"), makeBlock([{ x: 0, y: 0 }, { x: 0, y: 1 }, { x: 0, y: 2 }, { x: 0, y: 3 }], "white"), makeBlock([{ x: 0, y: 0 }, { x: 1, y: 0 }, { x: 0, y: 1 }, { x: 1, y: 1 }], "yellow"), makeBlock([{ x: 1, y: -1 }, { x: 1, y: 0 }, { x: 1, y: 1 }, { x: 0, y: 1 }], "magenta"), makeBlock([{ x: -1, y: -1 }, { x: -1, y: 0 }, { x: -1, y: 1 }, { x: 0, y: 1 }], "cyan")];

        var randomIndex = Math.floor(Math.random() * blocks.length);
        return blocks[randomIndex];
    };

    function makeBlock(points, blockColour) {
        var block = new _Tetromino2["default"](points, self, blockColour);
        block.position = {
            x: width / 2,
            y: block.height()
        };
        return block;
    }

    Grid.prototype.contains = function (coordinate) {
        return 0 <= coordinate.x && coordinate.x < width && 0 <= coordinate.y && coordinate.y < height;
    };

    return Grid;
})();

modules["export"] = Grid;

},{"./Tetromino":4}],3:[function(require,module,exports){
"use strict";

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var _Grid = require("./Grid");

var _Grid2 = _interopRequireDefault(_Grid);

var TetrisViewModel = (function () {
    var TetrisViewModel = function TetrisViewModel(width, height, colour) {
        var self = this;
        self.grid = new _Grid2["default"](width, height, colour);
    };

    TetrisViewModel.prototype.tick = function () {
        self.grid.moveDown();
    };

    TetrisViewModel.prototype.keyDown = function (viewModel, event) {
        var code = event.keyCode || event.which;
        if (code === 97) {
            self.grid.block.move({ x: -1, y: 0 });
        }
        if (code === 100) {
            self.grid.block.move({ x: 1, y: 0 });
        }
        if (code === 115) {
            self.grid.block.move({ x: 0, y: 1 });
        }
        if (code === 32) {
            self.grid.block.rotate();
        }
    };
})();

modules["export"] = TetrisViewModel;

},{"./Grid":2}],4:[function(require,module,exports){
"use strict";

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var _Grid = require("./Grid");

var _Grid2 = _interopRequireDefault(_Grid);

var Tetromino = (function () {

    var self;
    var Tetromino = function Tetromino(minos, grid, colour) {
        self = this;
    };

    Tetromino.prototype.height = function () {
        var yValues = minos.map(function (mino) {
            return mino.y;
        });
        var minY = Math.min.apply(null, yValues);
        var maxY = Math.max.apply(null, yValues);
        return maxY - minY;
    };

    Tetromino.prototype.getTiles = function () {
        return getOffsetCoordinates().map(function (coordinate) {
            if (!grid.contains(coordinate)) {
                throw new Error("Coordinate not in grid");
            } else {
                return grid.tiles()[coordinate.y][coordinate.x];
            }
        });
    };

    Tetromino.prototype.move = function (direction) {
        var canMoveBlock = canMove(direction);
        if (canMoveBlock) {
            redrawBlock(function () {
                self.position.y += direction.y;
                self.position.x += direction.x;
            });
        }
        return canMoveBlock;
    };

    Tetromino.prototype.rotate = function () {
        if (canRotate()) {
            redrawBlock(function () {
                minos = getRotated(minos);
            });
        }
    };

    function getRotated(coordinates) {
        return coordinates.map(function (coordinate) {
            return { x: coordinate.y, y: -coordinate.x };
        });
    }

    function canRotate() {
        return willFit(getOffsetCoordinates(getRotated(minos)));
    }

    function getOffsetCoordinates(coordinates) {
        coordinates = coordinates || minos;
        return coordinates.map(function (coordinate) {
            return {
                x: self.position.x + coordinate.x,
                y: self.position.y + coordinate.y
            };
        });
    }

    function redrawBlock(update) {
        self.getTiles().forEach(function (tile) {
            tile.occupied(false);
        });
        update();
        self.getTiles().forEach(function (tile) {
            tile.occupied(true);
            tile.colour(colour);
        });
    }

    function canMove(direction) {
        var coordinates = getOffsetCoordinates();
        return willFit(coordinates.map(function (tile) {
            return {
                x: tile.x + direction.x,
                y: tile.y + direction.y
            };
        }));
    }

    function willFit(coordinates) {
        var blockTiles = self.getTiles();
        return coordinates.every(function (coordinate) {
            var coordinateFree = false;
            if (grid.contains(coordinate)) {
                var tile = grid.tiles()[coordinate.y][coordinate.x];
                coordinateFree = !tile || blockTiles.indexOf(tile) !== -1 || !tile.occupied();
            }
            return coordinateFree;
        });
    }
    return Tetromino;
})();

modules["export"] = Tetromino;

},{"./Grid":2}]},{},[1])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJjOi9kZXYvRVM2VGV0cmlzL21haW4uanMiLCJjOi9kZXYvRVM2VGV0cmlzL3NyYy9HcmlkLmpzIiwiYzovZGV2L0VTNlRldHJpcy9zcmMvVGV0cmlzVmlld21vZGVsLmpzIiwiYzovZGV2L0VTNlRldHJpcy9zcmMvVGV0cm9taW5vLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7OztrQ0NBc0IsdUJBQXVCOzs7O0FBRTdDLElBQUksU0FBUyxHQUFHLElBQUksZUFBZSxDQUFDLEVBQUUsRUFBQyxFQUFFLEVBQUUsTUFBTSxDQUFDLENBQUM7Ozs7Ozs7eUJDRmpDLGFBQWE7Ozs7QUFFL0IsSUFBSSxJQUFJLEdBQUcsQ0FBQSxZQUFXO0FBQ2xCLFFBQUksSUFBSSxDQUFDO0FBQ1QsUUFBSSxHQUFHLEdBQUcsQ0FBQyxDQUFDO0FBQ1osUUFBSSxDQUFDLEtBQUssQ0FBQzs7QUFFWCxRQUFJLElBQUksR0FBRyxTQUFTLElBQUksQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFO0FBQ3BDLFlBQUksR0FBRyxJQUFJLENBQUM7QUFDWixZQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQyxlQUFlLEVBQUUsQ0FBQztBQUNsQyxhQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO0FBQzVCLGtCQUFNLEVBQUUsQ0FBQztTQUNaO0tBQ0osQ0FBQzs7QUFFRixhQUFTLE1BQU0sR0FBRztBQUNkLFlBQUksR0FBRyxHQUFHLEVBQUUsQ0FBRTtBQUNkLGFBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDM0IsZUFBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDekM7QUFDRCxZQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUMzQjs7QUFFRCxRQUFJLENBQUMsU0FBUyxDQUFDLGtCQUFrQixHQUFHLFlBQVc7QUFDM0MsWUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLE9BQU8sQ0FBQyxVQUFTLEdBQUcsRUFBRTtBQUMvQixnQkFBSSxXQUFXLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxVQUFTLElBQUksRUFBRTtBQUN0Qyx1QkFBTyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7YUFDM0IsQ0FBQyxDQUFDO0FBQ0gsZ0JBQUcsV0FBVyxFQUFFO0FBQ1osb0JBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ3ZCLHNCQUFNLEVBQUUsQ0FBQzthQUNaO1NBQ0osQ0FBQyxDQUFBO0tBQ0wsQ0FBQTs7QUFFRCxRQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsR0FBRyxZQUFXO0FBQ2pDLFlBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQztBQUMxQyxZQUFHLENBQUMsS0FBSyxFQUFDO0FBQ04sZ0JBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxFQUFFLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztBQUM5QyxnQkFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7U0FDN0I7S0FDSixDQUFDOztBQUVGLFFBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxHQUFFLFVBQVMsS0FBSyxFQUFFO0FBQ3ZDLFlBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0tBQ3BCLENBQUE7O0FBRUQsUUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLEdBQUcsWUFBVztBQUNwQyxZQUFJLE1BQU0sR0FBRyxDQUNULFNBQVMsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBQyxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsRUFDcEUsU0FBUyxDQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBQyxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFDLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxFQUN0RSxTQUFTLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFDLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLEVBQ3RFLFNBQVMsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBQyxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFB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QUFFO0FBQzFDLG1CQUFPO0FBQ0gsaUJBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxDQUFDO0FBQ3ZCLGlCQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQzthQUMxQixDQUFDO1NBQ0wsQ0FBQyxDQUFDLENBQUM7S0FDUDs7QUFFRCxhQUFTLE9BQU8sQ0FBQyxXQUFXLEVBQUU7QUFDMUIsWUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO0FBQ2pDLGVBQU8sV0FBVyxDQUFDLEtBQUssQ0FBQyxVQUFTLFVBQVUsRUFBRTtBQUMxQyxnQkFBSSxjQUFjLEdBQUcsS0FBSyxDQUFDO0FBQzNCLGdCQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLEVBQUU7QUFDMUIsb0JBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3BELDhCQUFjLEdBQUcsQ0FBQyxJQUFJLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQzthQUNqRjtBQUNELG1CQUFPLGNBQWMsQ0FBQztTQUN6QixDQUFDLENBQUM7S0FDVDtBQUNELFdBQU8sU0FBUyxDQUFDO0NBQ2pCLENBQUEsRUFBRSxDQUFDOztBQUVKLE9BQU8sVUFBTyxHQUFHLFNBQVMsQ0FBQyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJpbXBvcnQgdmlld21vZGVsIGZyb20gXCIuL3NyYy9UZXRyaXNWaWV3bW9kZWxcIjtcclxuXHJcbnZhciB2aWV3TW9kZWwgPSBuZXcgVGV0cmlzVmlld01vZGVsKDEyLDIwLCBcImJsdWVcIik7IiwiaW1wb3J0IEJsb2NrIGZyb20gXCIuL1RldHJvbWlub1wiXHJcblxyXG52YXIgR3JpZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIHNlbGY7XHJcbiAgICB2YXIgcm93ID0gMDsgICAgICAgIFxyXG4gICAgc2VsZi5ibG9jazsgIFxyXG5cclxuICAgIHZhciBHcmlkID0gZnVuY3Rpb24gR3JpZCh3aWR0aCwgaGVpZ2h0KSB7XHJcbiAgICAgICAgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgc2VsZi50aWxlcyA9IGtvLm9ic2VydmFibGVBcnJheSgpO1xyXG4gICAgICAgIGZvcih2YXIgeSA9IDA7IHkgPCBoZWlnaHQ7IHkrKykge1xyXG4gICAgICAgICAgICBhZGRSb3coKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBhZGRSb3coKSB7XHJcbiAgICAgICAgdmFyIHJvdyA9IFtdIDtcclxuICAgICAgICBmb3IodmFyIHggPSAwOyB4IDwgd2lkdGg7IHgrKykge1xyXG4gICAgICAgICAgICByb3dbeF0gPSBuZXcgVGlsZShmYWxzZSwgc2VsZi5jb2xvdXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzZWxmLnRpbGVzLnVuc2hpZnQocm93KTtcclxuICAgIH0gIFxyXG4gICAgXHJcbiAgICBHcmlkLnByb3RvdHlwZS5yZW1vdmVDb21wbGV0ZVJvd3MgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBzZWxmLnRpbGVzKCkuZm9yRWFjaChmdW5jdGlvbihyb3cpIHtcclxuICAgICAgICAgICAgdmFyIHJvd0NvbXBsZXRlID0gcm93LmV2ZXJ5KGZ1bmN0aW9uKHRpbGUpIHtcclxuICAgICAgICAgICAgICAgICByZXR1cm4gdGlsZS5vY2N1cGllZCgpOyAgIFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYocm93Q29tcGxldGUpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYudGlsZXMucmVtb3ZlKHJvdyk7XHJcbiAgICAgICAgICAgICAgICBhZGRSb3coKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcbiAgICBcclxuICAgIEdyaWQucHJvdG90eXBlLm1vdmVEb3duID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIG1vdmVkID0gc2VsZi5ibG9jay5tb3ZlKHt4OiAwLCB5OiAxfSk7XHJcbiAgICAgICAgaWYoIW1vdmVkKXtcclxuICAgICAgICAgICAgc2VsZi5hZGRCbG9jayhzZWxmLmdldE5ld0Jsb2NrKCksIHt4OjUsIHk6MH0pO1xyXG4gICAgICAgICAgICBzZWxmLnJlbW92ZUNvbXBsZXRlUm93cygpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBcclxuICAgIEdyaWQucHJvdG90eXBlLmFkZEJsb2NrPSBmdW5jdGlvbihibG9jaykge1xyXG4gICAgICBzZWxmLmJsb2NrID0gYmxvY2s7ICAgXHJcbiAgICB9XHJcbiAgICBcclxuICAgIEdyaWQucHJvdG90eXBlLmdldE5ld0Jsb2NrID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGJsb2NrcyA9IFtcclxuICAgICAgICAgICAgbWFrZUJsb2NrKFt7eDowLCB5OjB9LCB7eDowLCB5OjF9LCB7eDogMSwgeTogMX0sIHt4OjEsIHk6Mn1dLCBcInJlZFwiKSxcclxuICAgICAgICAgICAgbWFrZUJsb2NrKFt7eDowLCB5OjF9LCB7eDoxLCB5OjF9LCB7eDogMSwgeTogMH0sIHt4OjIsIHk6MH1dLCBcImdyZWVuXCIpLFxyXG4gICAgICAgICAgICBtYWtlQmxvY2soW3t4OjAsIHk6MH0sIHt4OjAsIHk6MX0sIHt4OiAwLCB5OiAyfSwge3g6MCwgeTozfV0sIFwid2hpdGVcIiksXHJcbiAgICAgICAgICAgIG1ha2VCbG9jayhbe3g6MCwgeTowfSwge3g6MSwgeTowfSwge3g6IDAsIHk6IDF9LCB7eDoxLCB5OjF9XSwgXCJ5ZWxsb3dcIiksXHJcbiAgICAgICAgICAgIG1ha2VCbG9jayhbe3g6MSwgeTotMX0sIHt4OjEsIHk6MH0sIHt4OiAxLCB5OiAxfSwge3g6MCwgeToxfV0sIFwibWFnZW50YVwiKSxcclxuICAgICAgICAgICAgbWFrZUJsb2NrKFt7eDotMSwgeTotMX0sIHt4Oi0xLCB5OjB9LCB7eDogLTEsIHk6IDF9LCB7eDowLCB5OjF9XSwgXCJjeWFuXCIpXHJcbiAgICAgICAgXTtcclxuICAgICAgICBcclxuICAgICAgICB2YXIgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBibG9ja3MubGVuZ3RoKTtcclxuICAgICAgICByZXR1cm4gYmxvY2tzW3JhbmRvbUluZGV4XTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIG1ha2VCbG9jayhwb2ludHMsIGJsb2NrQ29sb3VyKSB7XHJcbiAgICAgICAgdmFyIGJsb2NrID0gbmV3IEJsb2NrKCBcclxuICAgICAgICAgICAgcG9pbnRzLFxyXG4gICAgICAgICAgICBzZWxmLFxyXG4gICAgICAgICAgICBibG9ja0NvbG91cik7ICBcclxuICAgICAgICBibG9jay5wb3NpdGlvbiA9IHtcclxuICAgICAgICAgICAgeDogd2lkdGggLyAyLFxyXG4gICAgICAgICAgICB5OiBibG9jay5oZWlnaHQoKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGJsb2NrOyAgICAgICAgXHJcbiAgICB9XHJcbiAgICBcclxuICAgIEdyaWQucHJvdG90eXBlLmNvbnRhaW5zID0gZnVuY3Rpb24oY29vcmRpbmF0ZSkge1xyXG4gICAgICAgICByZXR1cm4gMCA8PSBjb29yZGluYXRlLnggJiYgY29vcmRpbmF0ZS54IDwgd2lkdGggJiYgMCA8PSBjb29yZGluYXRlLnkgJiYgY29vcmRpbmF0ZS55IDwgaGVpZ2h0OyAgXHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIEdyaWQ7XHJcbn0oKTtcclxuXHJcbm1vZHVsZXMuZXhwb3J0ID0gR3JpZDsiLCJpbXBvcnQgR3JpZCBmcm9tIFwiLi9HcmlkXCI7XHJcblxyXG52YXIgVGV0cmlzVmlld01vZGVsID0gZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgVGV0cmlzVmlld01vZGVsID0gZnVuY3Rpb24od2lkdGgsIGhlaWdodCwgY29sb3VyKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHNlbGYuZ3JpZCA9IG5ldyBHcmlkKHdpZHRoLCBoZWlnaHQsIGNvbG91cik7XHJcbiAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgVGV0cmlzVmlld01vZGVsLnByb3RvdHlwZS50aWNrID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgIHNlbGYuZ3JpZC5tb3ZlRG93bigpOyAgICAgICAgIFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBUZXRyaXNWaWV3TW9kZWwucHJvdG90eXBlLmtleURvd24gPSBmdW5jdGlvbih2aWV3TW9kZWwsZXZlbnQpIHtcclxuICAgICAgICB2YXIgY29kZSA9IGV2ZW50LmtleUNvZGUgfHwgZXZlbnQud2hpY2g7IFxyXG4gICAgICAgIGlmKGNvZGUgPT09IDk3KSB7XHJcbiAgICAgICAgICAgIHNlbGYuZ3JpZC5ibG9jay5tb3ZlKHt4Oi0xLCB5OjB9KTsgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGNvZGUgPT09IDEwMCkge1xyXG4gICAgICAgICAgICAgc2VsZi5ncmlkLmJsb2NrLm1vdmUoe3g6MSwgeTowfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGNvZGUgPT09IDExNSkge1xyXG4gICAgICAgICAgICBzZWxmLmdyaWQuYmxvY2subW92ZSh7eDowLCB5OjF9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoY29kZSA9PT0gMzIpIHtcclxuICAgICAgICAgICAgIHNlbGYuZ3JpZC5ibG9jay5yb3RhdGUoKTsgICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0oKTtcclxuXHJcbm1vZHVsZXMuZXhwb3J0ID0gVGV0cmlzVmlld01vZGVsOyIsImltcG9ydCBHcmlkIGZyb20gXCIuL0dyaWRcIjtcclxuXHJcbnZhciBUZXRyb21pbm8gPSBmdW5jdGlvbiAoKSB7XHJcblxyXG5cdHZhciBzZWxmO1xyXG5cdHZhciBUZXRyb21pbm8gPSBmdW5jdGlvbihtaW5vcywgZ3JpZCwgY29sb3VyKSB7XHJcblx0ICAgIHNlbGYgPSB0aGlzO1xyXG5cdH07XHJcblx0ICAgIFxyXG4gICAgVGV0cm9taW5vLnByb3RvdHlwZS5oZWlnaHQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgeVZhbHVlcyA9IG1pbm9zLm1hcChmdW5jdGlvbihtaW5vKSB7IFxyXG4gICAgICAgICAgICByZXR1cm4gbWluby55XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdmFyIG1pblkgPSBNYXRoLm1pbi5hcHBseShudWxsLCB5VmFsdWVzKTsgICBcclxuICAgICAgICB2YXIgbWF4WSA9IE1hdGgubWF4LmFwcGx5KG51bGwsIHlWYWx1ZXMpOyAgXHJcbiAgICAgICAgcmV0dXJuIG1heFkgLSBtaW5ZO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBUZXRyb21pbm8ucHJvdG90eXBlLmdldFRpbGVzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGdldE9mZnNldENvb3JkaW5hdGVzKCkubWFwKGZ1bmN0aW9uKGNvb3JkaW5hdGUpIHtcclxuICAgICAgICAgICAgaWYoIWdyaWQuY29udGFpbnMoY29vcmRpbmF0ZSkpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNvb3JkaW5hdGUgbm90IGluIGdyaWRcIik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZ3JpZC50aWxlcygpW2Nvb3JkaW5hdGUueV1bY29vcmRpbmF0ZS54XTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgVGV0cm9taW5vLnByb3RvdHlwZS5tb3ZlID0gZnVuY3Rpb24oZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgdmFyIGNhbk1vdmVCbG9jayA9IGNhbk1vdmUoZGlyZWN0aW9uKTtcclxuICAgICAgICBpZihjYW5Nb3ZlQmxvY2spIHtcclxuICAgICAgICAgICByZWRyYXdCbG9jayhmdW5jdGlvbigpIHsgICAgICAgICBcclxuICAgICAgICAgICBzZWxmLnBvc2l0aW9uLnkgKz0gZGlyZWN0aW9uLnk7XHJcbiAgICAgICAgICAgICAgc2VsZi5wb3NpdGlvbi54ICs9IGRpcmVjdGlvbi54O1xyXG4gICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY2FuTW92ZUJsb2NrO1xyXG4gICAgfSAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICBUZXRyb21pbm8ucHJvdG90eXBlLnJvdGF0ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmKGNhblJvdGF0ZSgpKSB7XHJcbiAgICAgICAgICAgIHJlZHJhd0Jsb2NrKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgbWlub3MgPSBnZXRSb3RhdGVkKG1pbm9zKTtcclxuICAgICAgICAgICAgfSk7ICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0Um90YXRlZChjb29yZGluYXRlcykge1xyXG4gICAgICAgIHJldHVybiBjb29yZGluYXRlcy5tYXAoZnVuY3Rpb24oY29vcmRpbmF0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4geyB4OiBjb29yZGluYXRlLnksIHk6IC1jb29yZGluYXRlLnh9OyAgXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIGNhblJvdGF0ZSgpIHtcclxuICAgICAgICByZXR1cm4gd2lsbEZpdChnZXRPZmZzZXRDb29yZGluYXRlcyhnZXRSb3RhdGVkKG1pbm9zKSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGdldE9mZnNldENvb3JkaW5hdGVzKGNvb3JkaW5hdGVzKSB7XHJcbiAgICAgICAgY29vcmRpbmF0ZXMgPSBjb29yZGluYXRlcyB8fCBtaW5vcztcclxuICAgICAgICByZXR1cm4gY29vcmRpbmF0ZXMubWFwKGZ1bmN0aW9uKGNvb3JkaW5hdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHg6IHNlbGYucG9zaXRpb24ueCArIGNvb3JkaW5hdGUueCxcclxuICAgICAgICAgICAgICAgIHk6IHNlbGYucG9zaXRpb24ueSArIGNvb3JkaW5hdGUueVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiByZWRyYXdCbG9jayh1cGRhdGUpIHtcclxuICAgICAgICBzZWxmLmdldFRpbGVzKCkuZm9yRWFjaChmdW5jdGlvbih0aWxlKSB7XHJcbiAgICAgICAgICAgIHRpbGUub2NjdXBpZWQoZmFsc2UpOyAgICAgICAgICAgIFxyXG4gICAgICAgIH0pOyAgICBcclxuICAgICAgICB1cGRhdGUoKTsgXHJcbiAgICAgICAgc2VsZi5nZXRUaWxlcygpLmZvckVhY2goZnVuY3Rpb24odGlsZSkge1xyXG4gICAgICAgICAgICB0aWxlLm9jY3VwaWVkKHRydWUpO1xyXG4gICAgICAgICAgICB0aWxlLmNvbG91cihjb2xvdXIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBjYW5Nb3ZlKGRpcmVjdGlvbikge1xyXG4gICAgICAgIHZhciBjb29yZGluYXRlcyA9IGdldE9mZnNldENvb3JkaW5hdGVzKCk7XHJcbiAgICAgICAgcmV0dXJuIHdpbGxGaXQoY29vcmRpbmF0ZXMubWFwKGZ1bmN0aW9uKHRpbGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHg6IHRpbGUueCArIGRpcmVjdGlvbi54LCBcclxuICAgICAgICAgICAgICAgIHk6IHRpbGUueSArIGRpcmVjdGlvbi55XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSkpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiB3aWxsRml0KGNvb3JkaW5hdGVzKSB7XHJcbiAgICAgICAgdmFyIGJsb2NrVGlsZXMgPSBzZWxmLmdldFRpbGVzKCk7XHJcbiAgICAgICAgcmV0dXJuIGNvb3JkaW5hdGVzLmV2ZXJ5KGZ1bmN0aW9uKGNvb3JkaW5hdGUpIHtcclxuICAgICAgICAgICAgdmFyIGNvb3JkaW5hdGVGcmVlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmKGdyaWQuY29udGFpbnMoY29vcmRpbmF0ZSkpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0aWxlID0gZ3JpZC50aWxlcygpW2Nvb3JkaW5hdGUueV1bY29vcmRpbmF0ZS54XTtcclxuICAgICAgICAgICAgICAgIGNvb3JkaW5hdGVGcmVlID0gIXRpbGUgfHwgYmxvY2tUaWxlcy5pbmRleE9mKHRpbGUpICE9PSAtMSB8fCAhdGlsZS5vY2N1cGllZCgpOyBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gY29vcmRpbmF0ZUZyZWU7XHJcbiAgICAgICAgfSk7ICAgIFxyXG5cdH1cclxuXHRyZXR1cm4gVGV0cm9taW5vO1xyXG59KCk7XHJcblxyXG5tb2R1bGVzLmV4cG9ydCA9IFRldHJvbWlubzsiXX0=
